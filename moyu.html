<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>æ‘¸é±¼åŠ v3.4 æ›´æ–°ï¼ˆé€€ä¼‘è¿›åº¦æ¡ + æ’åºè°ƒæ•´ï¼‰</title>
<style>
:root{
  --bg1: linear-gradient(135deg,#f6fbff,#fff1f8);
  --card: rgba(255,255,255,0.95);
  --text:#222;
  --muted:#555;
  --accent:#ff7eb3;
  --accent2:#60d3ff;
  --shadow:0 8px 24px rgba(0,0,0,0.08);
}
body.dark{
  --bg1: linear-gradient(135deg,#0f1724,#1a2234);
  --card: rgba(20,24,34,0.9);
  --text:#eaeef5;
  --muted:#aab5cc;
  --accent:#60d3ff;
  --shadow:0 6px 20px rgba(0,0,0,0.5);
}
*{box-sizing:border-box}
body{
  margin:0;padding:0;font-family:"PingFang SC","Segoe UI",Arial,sans-serif;
  background:var(--bg1);color:var(--text);
  height:100vh;overflow:hidden;font-size:115%;transition:all .4s;position:relative;
}

/* æ°”æ³¡ */
.bubbles{position:fixed;top:0;left:0;width:100%;height:100%;overflow:hidden;z-index:0}
.bubble{position:absolute;bottom:-100px;background:rgba(255,255,255,0.25);border-radius:50%;animation:rise 20s infinite linear}
@keyframes rise{0%{transform:translateY(0) scale(1);opacity:0.7}100%{transform:translateY(-120vh) scale(1.5);opacity:0}}
body.dark .bubble{background:rgba(80,160,255,0.18)}

/* å®¹å™¨ */
.container{max-width:1100px;margin:0 auto;padding:24px;height:100vh;display:flex;flex-direction:column;justify-content:space-between;position:relative;z-index:2}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.title{font-size:28px;font-weight:700;display:flex;align-items:center;gap:10px}
.sub{font-size:15px;color:var(--muted)}

/* ä¸¤åˆ—ç½‘æ ¼ */
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px;flex-grow:1}
@media(max-width:760px){.grid{grid-template-columns:1fr}}

/* å¡ç‰‡æ ·å¼ */
.card{background:var(--card);border-radius:14px;padding:22px;box-shadow:var(--shadow);display:flex;flex-direction:column;}
.card h4{margin:0 0 10px 0;font-size:20px}
.small{font-size:15px;color:var(--muted)}

/* è¿›åº¦æ¡ */
.progress{height:14px;border-radius:999px;background:rgba(0,0,0,0.08);overflow:hidden;margin:10px 0}
.progress .bar{height:100%;background:var(--accent);width:0%;transition:width 1s}
.progress.retire .bar{background:linear-gradient(90deg,var(--accent2),var(--accent))}

/* åˆ—è¡¨ */
ul.min{list-style:none;padding:0;margin:10px 0 0 0}
ul.min li{padding:8px 0;border-bottom:1px dashed rgba(0,0,0,0.08);font-size:17px}

/* è®¾ç½®æŒ‰é’® / é¢æ¿ */
.settings-btn{position:fixed;right:28px;bottom:28px;width:58px;height:58px;border-radius:50%;background:var(--accent);color:#fff;font-size:26px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 10px 30px rgba(255,120,160,0.3);z-index:10;transition:all .25s}
.settings-btn:hover{transform:rotate(90deg) scale(1.05)}
#panel{position:fixed;right:28px;bottom:100px;width:360px;background:var(--card);border-radius:14px;box-shadow:var(--shadow);padding:18px;display:none;z-index:1000;max-height:75vh;overflow:auto}
#panel h3{margin-top:0;font-size:18px}
#panel label{display:block;margin-top:10px;font-size:13px;color:var(--muted)}
#panel input,#panel select{width:100%;padding:8px;border-radius:6px;border:1px solid rgba(0,0,0,0.08);margin-top:6px;background:transparent;color:var(--text)}
#panel button{width:100%;margin-top:12px;padding:10px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}

.footer{text-align:center;font-size:13px;color:var(--muted);margin-top:12px}
.quote{margin-top:8px;text-align:center;font-style:italic;color:var(--accent);font-size:15px}
</style>
</head>
<body>
  <div class="bubbles" id="bubbles"></div>

  <div class="container">
    <div class="header">
      <div>
        <div class="title">ğŸŸ æ‘¸é±¼åŠä»ªè¡¨ç›˜ <span style="font-size:14px;color:var(--muted)">v3.4</span></div>
        <div class="sub">æ—¥å† Â· æ°”æ³¡åŠ¨ç”» Â· æœ¬åœ°ä¿å­˜</div>
      </div>
      <div style="text-align:right">
        <div id="nowTime" class="sub"></div>
        <div id="tz" class="sub"></div>
      </div>
    </div>

    <div class="grid">
      <!-- ä»Šæ—¥è¿›åº¦ -->
      <div class="card">
        <h4>ä»Šæ—¥æ‘¸é±¼è¿›åº¦</h4>
        <div class="progress"><div class="bar" id="bar-today"></div></div>
        <div class="small" id="today-info"></div>
      </div>

      <!-- æœ¬å‘¨è¿›åº¦ -->
      <div class="card">
        <h4>æœ¬å‘¨æ‘¸é±¼è¿›åº¦</h4>
        <div class="progress"><div class="bar" id="bar-week"></div></div>
        <div class="small" id="week-info"></div>
      </div>

      <!-- å‘¨æœ« -->
      <div class="card">
        <h4>è·ç¦»å‘¨æœ«</h4>
        <div class="small" id="weekend"></div>
      </div>

      <!-- å‘å·¥èµ„ -->
      <div class="card">
        <h4>è·ç¦»å‘å·¥èµ„ï¼ˆ20å·ï¼‰</h4>
        <div class="small" id="salary"></div>
      </div>

      <!-- è‡ªå®šä¹‰å€’è®¡æ—¶ï¼ˆå¹¶åˆ— å·¦ï¼‰ -->
      <div class="card">
        <h4>è‡ªå®šä¹‰å€’è®¡æ—¶</h4>
        <ul class="min" id="custom-list"></ul>
      </div>

      <!-- èŠ‚å‡æ—¥å€’è®¡æ—¶ï¼ˆå¹¶åˆ— å³ï¼‰ -->
      <div class="card">
        <h4>èŠ‚å‡æ—¥å€’è®¡æ—¶</h4>
        <ul class="min" id="holiday-list"></ul>
      </div>

      <!-- é€€ä¼‘å€’è®¡æ—¶ï¼ˆå«è¿›åº¦æ¡ï¼‰ -->
      <div class="card">
        <h4>é€€ä¼‘å€’è®¡æ—¶</h4>
        <div class="small" id="retire-info"></div>
        <div class="progress retire"><div class="bar" id="bar-retire"></div></div>
        <div class="small" id="retire-remaining"></div>
      </div>

      <!-- æ‘¸é±¼è¯­å½•ï¼ˆä¸é€€ä¼‘å¹¶åˆ—ï¼‰ -->
      <div class="card">
        <h4>æ‘¸é±¼è¯­å½•</h4>
        <div class="quote" id="quote"></div>
      </div>
    </div>

    <div class="footer">Â© 2025 æ‘¸é±¼åŠ Â· æ—¥å†ç‰ˆ</div>
  </div>

  <div class="settings-btn" id="btn-settings">âš™ï¸</div>

  <div id="panel">
    <h3>è®¾ç½®</h3>
    <label>ä¸Šç­æ—¶é—´</label>
    <input type="time" id="cfg-start">
    <label>ä¸‹ç­æ—¶é—´</label>
    <input type="time" id="cfg-end">
    <label>å…¥èŒæ—¥æœŸ</label>
    <input type="date" id="cfg-hire">
    <label>æ€§åˆ«ï¼ˆç”¨äºé€€ä¼‘å¹´é¾„è®¡ç®—ï¼‰</label>
    <select id="cfg-gender"><option value="male">ç”·ï¼ˆ60å²ï¼‰</option><option value="female">å¥³ï¼ˆ55å²ï¼‰</option></select>
    <label>ç§¯æè¯­å½•æ—¶é—´æ®µï¼ˆèµ·å§‹ï¼‰</label><input type="time" id="cfg-active-start">
    <label>ç§¯æè¯­å½•æ—¶é—´æ®µï¼ˆç»“æŸï¼‰</label><input type="time" id="cfg-active-end">
    <label>åˆ·æ–°é—´éš”ï¼ˆç§’ï¼Œæœ€å°5ï¼‰</label>
    <input type="number" id="cfg-refresh" min="5" step="1">
    <label>å¤œé—´æ¨¡å¼</label>
    <select id="cfg-dark"><option value="off">å…³é—­</option><option value="on">å¼€å¯</option></select>
	<label>å·¥ä½œæ—¥èŒƒå›´ï¼ˆ1-7ï¼Œä¾‹å¦‚ 1-5ï¼‰</label>
	<input type="text" id="cfg-weekdays" placeholder="é»˜è®¤ 1-5">
    <label>è‡ªå®šä¹‰å€’è®¡æ—¶ 1</label><input type="text" id="c1-name" placeholder="åç§°"><input type="date" id="c1-date">
    <label>è‡ªå®šä¹‰å€’è®¡æ—¶ 2</label><input type="text" id="c2-name" placeholder="åç§°"><input type="date" id="c2-date">
    <label>è‡ªå®šä¹‰å€’è®¡æ—¶ 3</label><input type="text" id="c3-name" placeholder="åç§°"><input type="date" id="c3-date">
    <label>è‡ªå®šä¹‰å€’è®¡æ—¶ 4</label><input type="text" id="c4-name" placeholder="åç§°"><input type="date" id="c4-date">
	<label>è‡ªå®šä¹‰å€’è®¡æ—¶ 5</label><input type="text" id="c5-name" placeholder="åç§°"><input type="date" id="c5-date">
	<label>å‘è–ªæ—¥æœŸï¼ˆ1-31ï¼‰</label>
	<input type="number" id="cfg-salaryday" min="1" max="31" placeholder="é»˜è®¤ 20">
    <button id="save">ä¿å­˜</button>
  </div>

<script>
/* v3.4 updated script
 - æ’åºè°ƒæ•´ï¼šcustom ä¸ holiday å¹¶åˆ—ï¼›retire ä¸ quote å¹¶åˆ—
 - é€€ä¼‘è¿›åº¦æ¡ï¼šè¡¨ç¤º (now - hire) / (retire - hire)
 - æ”¯æŒ 4 ä¸ªè‡ªå®šä¹‰å€’è®¡æ—¶
 - æ™ºèƒ½è¯­å½•ï¼ˆç§¯æ/æ”¾æ¾/ç‰¹æ®Šäº‹ä»¶ï¼‰
 - æ°”æ³¡åŠ¨ç”»ã€localStorageã€åˆ·æ–°é—´éš”ã€å¤œé—´æ¨¡å¼ä¿ç•™
*/

const STORAGE_KEY = "moyu_v34_updated";
const DEFAULT = {
  start: "09:00",
  end: "18:00",
  hire: new Date().toISOString().split("T")[0],
  gender: "male",
  refresh: 60,
  dark: "off",
  activeStart: "09:00",
  activeEnd: "11:00",
  salaryDay: 20, // âœ… é»˜è®¤å‘è–ªæ—¥
  custom: [] // up to 4 {n,d}
};

let cfg = {};
let timer = null;

// load settings
function load(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    cfg = Object.assign({}, DEFAULT, raw ? JSON.parse(raw) : {});
  } catch(e) {
    cfg = Object.assign({}, DEFAULT);
  }
  document.body.classList.toggle("dark", cfg.dark === "on");
}

// save settings (reads panel inputs)
function save(){
  cfg.start = document.getElementById("cfg-start").value || DEFAULT.start;
  cfg.end = document.getElementById("cfg-end").value || DEFAULT.end;
  cfg.hire = document.getElementById("cfg-hire").value || DEFAULT.hire;
  cfg.gender = document.getElementById("cfg-gender").value || DEFAULT.gender;
  cfg.activeStart = document.getElementById("cfg-active-start").value || DEFAULT.activeStart;
  cfg.activeEnd = document.getElementById("cfg-active-end").value || DEFAULT.activeEnd;
  cfg.refresh = Math.max(5, parseInt(document.getElementById("cfg-refresh").value) || DEFAULT.refresh);
  cfg.dark = document.getElementById("cfg-dark").value || DEFAULT.dark;
  cfg.weekdays = document.getElementById("cfg-weekdays").value || "1-5";
  cfg.salaryDay = parseInt(document.getElementById("cfg-salaryday").value) || DEFAULT.salaryDay;
  // customs: 5
  const customs = [];
  for(let i=1;i<=5;i++){
    const name = document.getElementById(`c${i}-name`).value.trim();
    const date = document.getElementById(`c${i}-date`).value;
    if(name && date) customs.push({n:name, d:date});
  }
  cfg.custom = customs;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg));
  document.body.classList.toggle("dark", cfg.dark === "on");
  start(); // restart timer
}

// fill panel with current cfg
function fillPanel(){
  document.getElementById("cfg-start").value = cfg.start;
  document.getElementById("cfg-end").value = cfg.end;
  document.getElementById("cfg-hire").value = cfg.hire;
  document.getElementById("cfg-gender").value = cfg.gender;
  document.getElementById("cfg-active-start").value = cfg.activeStart;
  document.getElementById("cfg-active-end").value = cfg.activeEnd;
  document.getElementById("cfg-refresh").value = cfg.refresh;
  document.getElementById("cfg-dark").value = cfg.dark;
  document.getElementById("cfg-weekdays").value = cfg.weekdays || "1-5";
  document.getElementById("cfg-salaryday").value = cfg.salaryDay;
  for(let i=1;i<=5;i++){
    document.getElementById(`c${i}-name`).value = cfg.custom[i-1]?.n || "";
    document.getElementById(`c${i}-date`).value = cfg.custom[i-1]?.d || "";
  }
}

// small helpers
function fmtMs(ms){
  if(ms <= 0) return "å·²åˆ°";
  const d = Math.floor(ms / 86400000);
  const h = Math.floor((ms % 86400000) / 3600000);
  const m = Math.floor((ms % 3600000) / 60000);
  return `${d}å¤©${h}å°æ—¶${m}åˆ†é’Ÿ`;
}
function daysCeil(a,b){ return Math.ceil((b - a) / 86400000); }
function clamp(n,min,max){ return Math.min(max, Math.max(min, n)); }

// update UI (core)
function update(){
  const now = new Date();
  document.getElementById("nowTime").textContent = now.toLocaleString();
  document.getElementById("tz").textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;

  // ä»Šæ—¥è¿›åº¦
  const [sh,sm] = cfg.start.split(":").map(Number);
  const [eh,em] = cfg.end.split(":").map(Number);
  const dayStart = new Date(now); dayStart.setHours(sh,sm,0,0);
  const dayEnd = new Date(now); dayEnd.setHours(eh,em,0,0);
  const pctToday = clamp((now - dayStart) / (dayEnd - dayStart) * 100, 0, 100);
  document.getElementById("bar-today").style.width = pctToday.toFixed(2) + "%";
  document.getElementById("today-info").textContent = `å·²è¿‡ ${pctToday.toFixed(1)}%ï¼Œç¦»ä¸‹ç­ ${fmtMs(dayEnd - now)}`;

  // âœ… æœ¬å‘¨è¿›åº¦ï¼ˆæ”¯æŒè‡ªå®šä¹‰å·¥ä½œå‘¨ï¼‰
  const weekRange = (cfg.weekdays || "1-5").split("-");
  const startDay = parseInt(weekRange[0]), endDay = parseInt(weekRange[1]);
  const cur = new Date(now);
  const day = cur.getDay() || 7; // å‘¨æ—¥=7
  const weekStart = new Date(cur); weekStart.setDate(cur.getDate() - (day - startDay)); weekStart.setHours(0,0,0,0);
  const weekEnd = new Date(cur); weekEnd.setDate(cur.getDate() + (endDay - day)); weekEnd.setHours(23,59,59,999);
  const weekPct = clamp((now - weekStart) / (weekEnd - weekStart) * 100, 0, 100);
  document.getElementById("bar-week").style.width = weekPct.toFixed(2) + "%";
  document.getElementById("week-info").textContent = `å·²è¿‡ ${weekPct.toFixed(1)}%ï¼Œå‰©ä½™ ${(100-weekPct).toFixed(1)}%`;

  // å‘¨æœ«å€’è®¡æ—¶
  const nextSat = new Date(now); nextSat.setDate(now.getDate() + ((6 - now.getDay()) % 7)); nextSat.setHours(0,0,0,0);
  document.getElementById("weekend").textContent = fmtMs(nextSat - now);

 // âœ… å‘è–ªï¼ˆæ”¯æŒè‡ªå®šä¹‰å‘è–ªæ—¥ï¼‰
 let pay = new Date(now.getFullYear(), now.getMonth(), cfg.salaryDay);
 if (now > pay) pay.setMonth(pay.getMonth() + 1);
 document.getElementById("salary").textContent = fmtMs(pay - now);
 // åŠ¨æ€æ›´æ–°æ ‡é¢˜
const salaryTitle = document.querySelector('h4:has(+ #salary)'); // é€‰ä¸­â€œè·ç¦»å‘å·¥èµ„â€è¿™å¼ å¡ç‰‡çš„æ ‡é¢˜
if (salaryTitle) salaryTitle.textContent = `è·ç¦»å‘å·¥èµ„ï¼ˆ${cfg.salaryDay}å·ï¼‰`;

  // è‡ªå®šä¹‰å€’è®¡æ—¶
  const cl = document.getElementById("custom-list"); cl.innerHTML = "";
  for(let i=0;i<5;i++){
    const c = cfg.custom[i];
    const li = document.createElement("li");
    if(c){
      const t = new Date(c.d);
      li.textContent = `${c.n}ï¼šè¿˜æœ‰ ${daysCeil(now,t)} å¤© (${c.d})`;
    } else li.textContent = `${i+1}. æœªè®¾ç½®`;
    cl.appendChild(li);
  }

  // èŠ‚å‡æ—¥
  const HOL = [
    {n:"å…ƒæ—¦",m:1,d:1},
    {n:"æ˜¥èŠ‚",m:2,d:1},
	{n:"æ¸…æ˜èŠ‚",m:4,d:4},
    {n:"åŠ³åŠ¨èŠ‚",m:5,d:1},
    {n:"å›½åº†èŠ‚",m:10,d:1}
  ];
  const hl = document.getElementById("holiday-list"); hl.innerHTML="";
  HOL.forEach(h=>{
    let t = new Date(now.getFullYear(),h.m-1,h.d);
    if(t<now) t.setFullYear(t.getFullYear()+1);
    const li=document.createElement("li");
    li.textContent=`${h.n}ï¼šè¿˜æœ‰ ${daysCeil(now,t)} å¤© (${t.getFullYear()}-${h.m}-${h.d})`;
    hl.appendChild(li);
  });

  // âœ… é€€ä¼‘å€’è®¡æ—¶ï¼ˆæœˆæ•°æ˜¾ç¤ºï¼‰
  const hireDate = new Date(cfg.hire);
  const retireYears = cfg.gender==="female"?55:60;
  const retireDate = new Date(hireDate); retireDate.setFullYear(hireDate.getFullYear()+retireYears);
  const totalMonths = (retireDate.getFullYear()-hireDate.getFullYear())*12 + retireDate.getMonth()-hireDate.getMonth();
  const passedMonths = (now.getFullYear()-hireDate.getFullYear())*12 + now.getMonth()-hireDate.getMonth();
  const pct = clamp(passedMonths/totalMonths*100,0,100);
  document.getElementById("bar-retire").style.width = pct.toFixed(2)+"%";
  document.getElementById("retire-info").textContent = `å…¥èŒï¼š${cfg.hire} ãƒ» é€€ä¼‘å¹´é¾„ï¼š${retireYears}å²`;
  document.getElementById("retire-remaining").textContent = `å·²å·¥ä½œ ${passedMonths} ä¸ªæœˆ Â· å‰©ä½™ ${totalMonths - passedMonths} ä¸ªæœˆ`;

// âœ… æ™ºèƒ½æ‘¸é±¼è¯­å½•ç³»ç»Ÿ
const quoteEl = document.getElementById("quote");
quoteEl.style.opacity = "0";

setTimeout(() => {
  const activeQuotes = [
    "æ‘¸é±¼æ˜¯é—¨è‰ºæœ¯ï¼Œè¦è®²èŠ‚å¥ ğŸ¨",
    "è®¤çœŸæ‘¸é±¼ï¼Œå¿«ä¹åŠ å€ ğŸ ",
    "æ•ˆç‡æ‘¸é±¼ä¸¤ä¸è¯¯ ğŸ’¼",
    "æ”¾æ¾ç‰‡åˆ»ï¼Œæ›´å¥½å‡ºå‘ â˜•",
    "æ‘¸é±¼ä¸è¯¯æ­£ä¸šï¼Œåè€ŒåŠ©åŠ›æ•ˆç‡ âš¡"
  ];

  const relaxQuotes = [
    "æ‘¸é±¼ä½¿æˆ‘å¿«ä¹ ğŸ˜",
    "æ‘¸é±¼æ˜¯å¯¹å·¥ä½œçš„å°Šé‡ âœ¨",
    "ä½ æ‘¸ï¼Œæˆ‘æ‘¸ï¼Œå¤§å®¶éƒ½æ‘¸ ğŸŸ",
    "ä¸€æ‘¸è§£åƒæ„ ğŸƒ",
    "ä»Šå¤©ä¹Ÿè¦æ‘¸å¾—è‡ªç„¶ ğŸ§˜"
  ];

  const weekendQuotes = [
    "å·¥ä½œæ‰å¼€å§‹ï¼Œå¿ç€ï¼ğŸ’ª",
    "èƒœåˆ©åœ¨æœ›ï¼Œæ‘¸é±¼è“„åŠ›ï¼ğŸš€",
    "ä»Šå¤©å°±æ˜¯å‘¨äº”ï¼æ­å–œä¸‹ç­ï¼ğŸ‰"
  ];

  const salaryQuotes = [
    "é’±åŒ…æ­£åœ¨è·¯ä¸Šï¼Œè¯·æ³¨æ„æŸ¥æ”¶ ğŸ’°",
    "å‘è–ªå€’è®¡æ—¶ï¼Œä¿¡å¿ƒæ»¡æ»¡ ğŸ’µ"
  ];

  const hr = now.getHours();

  // è®¡ç®—è·ç¦»å‘¨æœ«
  const nextSat = new Date(now);
  nextSat.setDate(now.getDate() + ((6 - now.getDay()) % 7));
  nextSat.setHours(0, 0, 0, 0);
  const daysToWeekend = daysCeil(now, nextSat);

 // è®¡ç®—è·ç¦»å‘è–ªï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰
  let pay = new Date(now.getFullYear(), now.getMonth(), cfg.salaryDay);
  if (now > pay) pay.setMonth(pay.getMonth() + 1);
  const daysToPay = daysCeil(now, pay);


  let quote = "";

  // ğŸ§­ ä¼˜å…ˆçº§ï¼šå‘è–ª â†’ å‘¨æœ« â†’ æ™®é€šæ—¶é—´æ®µ
  if (daysToPay < 5) {
    quote = salaryQuotes[Math.floor(Math.random() * salaryQuotes.length)];
  } else if (daysToWeekend > 3) {
    quote = weekendQuotes[0]; // â€œå·¥ä½œæ‰å¼€å§‹ï¼Œå¿ç€ï¼â€
  } else if (daysToWeekend === 1) {
    quote = weekendQuotes[1]; // â€œèƒœåˆ©åœ¨æœ›...â€
  } else if (daysToWeekend === 0) {
    quote = weekendQuotes[2]; // â€œä»Šå¤©å°±æ˜¯å‘¨äº”ï¼â€
  } else {
    // åˆ¤æ–­ç§¯ææ—¶é—´æ®µï¼ˆå¯é…ç½®ï¼‰
    const [ah, am] = cfg.activeStart.split(":").map(Number);
    const [bh, bm] = cfg.activeEnd.split(":").map(Number);
    const activeStart = ah * 60 + am;
    const activeEnd = bh * 60 + bm;
    const current = hr * 60 + now.getMinutes();
    if (current >= activeStart && current <= activeEnd) {
      quote = activeQuotes[Math.floor(Math.random() * activeQuotes.length)];
    } else {
      quote = relaxQuotes[Math.floor(Math.random() * relaxQuotes.length)];
    }
  }

  quoteEl.textContent = quote;
  quoteEl.style.transition = "opacity 1s";
  quoteEl.style.opacity = "1";
}, 100);
}

// start timer respecting cfg.refresh
function start(){
  if(timer) clearInterval(timer);
  update();
  timer = setInterval(update, cfg.refresh * 1000);
}

// bubbles
function createBubbles(){
  const wrapper = document.getElementById("bubbles");
  wrapper.innerHTML = "";
  for(let i=0;i<16;i++){
    const b = document.createElement("div");
    b.className = "bubble";
    const size = Math.round(Math.random()*45 + 10);
    b.style.width = size + "px";
    b.style.height = size + "px";
    b.style.left = (Math.random()*90) + "%";
    b.style.animationDuration = (12 + Math.random()*12) + "s";
    b.style.animationDelay = (Math.random()*8) + "s";
    wrapper.appendChild(b);
  }
}

// UI bindings
document.getElementById("btn-settings").onclick = () => {
  const p = document.getElementById("panel");
  p.style.display = (p.style.display === "block") ? "none" : "block";
  fillPanel();
};
document.getElementById("save").onclick = () => {
  save();
  document.getElementById("panel").style.display = "none";
};

// init
load();
createBubbles();
start();

</script>
</body>
</html>
